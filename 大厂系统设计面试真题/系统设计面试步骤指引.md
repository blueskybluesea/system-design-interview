很多软件工程师受困于系统设计面试，主要有以下几点原因：

- 开放式的题目，没有固定的套路，没有固定的答案
- 缺乏大规模复杂系统的开发经验
- 缺乏充足的准备

那么，接下来逐步介绍如何解决系统面试中的复杂系统设计问题。

![](https://cdn.nlark.com/yuque/0/2022/png/640636/1646535721304-a433f227-a50d-4098-bb5b-02323f1695b8.png)

# 理清需求

首先我们必须理清需要解决的问题的详细需求。系统设计问题由于是开放式的，没有唯一确定的答案，如果我们对问题需求理解存在偏差，那么整个面试就很难获得成功。而且面试时间通常只有35-40分钟，因此我们需要把精力集中在重点模块上。

下面让我们看一个实际的例子，假设我们要设计一个类似Twitter的系统，那么首先我们需要弄清楚如下几个问题：

- 是否需要支持用户发推特以及关注其他人
- 是否需要展示用户的活动时间线
- 推特内容是否需要包含照片和视频
- 除了后端，前端是否也需要考虑
- 是否支持用户搜索推特内容
- 是否需要展示热点趋势话题
- 新推特是否需要支持通知

# 接口定义

这一步需要定义出系统中的核心接口。定义出接口能够准确体现系统不同模块的交互，还能review看看我们理解是否和问题需求有偏差。

比如推特系统的相关API定义：

//发推
postTweet(user_id, tweet_data, tweet_location, user_location, timestamp, ...)

//生成用户活动时间线
generateTimeline(user_id, current_time, user_location, ...)

//标记
markTweetFavorite(user_id, tweet_id, timestamp, ...)

# 系统量级规模估计

估计出系统需要支持的量级，在后续进行伸缩性、分片、负载均衡和缓存设计的时候会用到：

- 系统需要支持的业务流量量级（发新推的量级、推特的查看量级等）
- 存储空间大小（是否需要支持照片和视频对存储空间大小评估影响很大）
- 网络带宽

# 定义数据模型

即领域模型定义。通过定义数据模型，明确数据在系统不同模块之间的流向变得清晰，也在后续的数据分片和管理上起到指导作用。我们需要确定出系统中的不同实体、相互之间怎么交互、以及和存储、传输、加密等数据管理设施之间的关系。

比如类Twitter系统可以如下定义数据模型：

- User（UserId、Name、Email、DoB、CreationData、LastLogin）
- Tweet（TweetId、Content、TweetLocation、NumberOfLikes、Timestamp）
- UserFollower（UserId1、UserId2）
- FavoriteTweets（Userid、TweetId1、TimeStamp）

# 概要设计（High-level design）

通过图示画出系统中的核心模块。

类Twitter系统的概要设计图如下。如果流量较大，可能需要考虑采用多台服务器，还需要负载均衡设备。另外还可以考虑读写分离。

![](https://cdn.nlark.com/yuque/0/2022/png/640636/1646099387503-345aa366-4ee8-41fe-82aa-6b6a5a7b347a.png)

# 详细设计（Detailed design）

对核心模块进行深挖，进行深入讨论。可能会有多种方案，我们需要对多种方案的优缺点进行权衡。

- 数据量级越来越大，如何进行数据的存储？如何将数据分片存储到多台服务器上？
- 大V热点问题如何解决？
- 用户时间线数据查询优化（scan）
- 缓存的使用

# 系统瓶颈分析

讨论系统中可能的瓶颈，并讨论解决方案。

- 是否存在单点问题，单点异常或失败了如何处理
- 是否有足够的数据副本在部分服务器宕机的时候仍然能提供服务
- 服务的性能监控、告警、降级
